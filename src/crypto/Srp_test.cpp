#include <cheat.h>
#include "./Srp.h"
#include "../utils/Config.h"
#include "../utils/Utils.h"

CHEAT_TEST(srp_encoding,
    Srp *message = new Srp();
    cheat_assert(strncmp(
        "2e56ef90af3d130a1e7aca778660ed96d9441803677af1a8d1f3b8f9fe42819c474a309cc2fc8cee60ce14bb792ac7955489c4a02a1b0444d7f4adf4f53371dc6332a5a7a8f739de6bd961a4188cc7ea24267c7f48ccf0a30cdeb2308eee60bfef9d5e60bc358aa4567b488bf4de93cddbbf7125576c4a2f29333fa20c50860c",
        toLowerCase(message->HexPublicKey()),
        256
    ) == 0);
)

CHEAT_TEST(srp_client_session,
    Srp *message = new Srp();
    BIGNUM *K = message->ClientSession(
        (char*)&"SYSDBA",
        (char*)&"demo",
        (char*)&"810B6DCD6973C0DDC8A580B5F16B33A11A348B6FA207117298250E572B4A9F55",
        (char*)&"32540768813473831162194345688899562662151405286404722627482015576219291240489120340586512423951114285116271924679793440736696836963413758431931078890357671187202217726287495744843592844628554908415637028726195274953983880076362213338708547239162412048257199994990212405166367925191408500758102141815569286668",
        (char*)&"61608907854645850435527880493962314797398644222843036511828709876515359203718776945971694322813244825368613919223677555053276926633146397778401805690801603599374738568614725085162265210346493396671620960131504631521907922242650969970957977071641984877686899640640733518930940873621968608302948529937808157306",
        (char*)&"704977699946006238325217721878048915144304697624433950091882671206794807080395933853758734597676611847529858352436836696701136348291829892128813453488133821089285856568099942260008704318612133801776795890529434387600590911146913260682012198199322498679805924253279600940969591915606730607197475802447937793"
    );
    cheat_assert(strncmp(
        "9b48d537ad195df59fcfcd7281e376027f81398f",
        toLowerCase(BN_bn2hex(K)),
        40
    ) == 0);
)

CHEAT_TEST(srp_client_session_2,
    Srp *message = new Srp();
    BIGNUM *K = message->ClientSession(
        (char*)&"DEMO",
        (char*)&"demo",
        (char*)&"D863D2566A2381E73AC7DE76946A5CF3AB9C33208AE8A58B5B96481AFC457F8E",
        (char*)&"32540768813473831162194345688899562662151405286404722627482015576219291240489120340586512423951114285116271924679793440736696836963413758431931078890357671187202217726287495744843592844628554908415637028726195274953983880076362213338708547239162412048257199994990212405166367925191408500758102141815569286668",
        (char*)&"75992247277227417509107891849526254487264144026329715491387163756398485088591599517762016821886063336844764062027962034471912016251196898523091700474477370837674432642406692215093345472761694766922701354912839040039739000694886860417899528013506074236580717874380236934414182616153484939801032568312725627057",
        (char*)&"704977699946006238325217721878048915144304697624433950091882671206794807080395933853758734597676611847529858352436836696701136348291829892128813453488133821089285856568099942260008704318612133801776795890529434387600590911146913260682012198199322498679805924253279600940969591915606730607197475802447937793"
    );
    HexStringToAscii("2e56ef90af3d130a1e7aca778660ed96d9441803677af1a8d1f3b8f9fe42819c474a309cc2fc8cee60ce14bb792ac7955489c4a02a1b0444d7f4adf4f53371dc6332a5a7a8f739de6bd961a4188cc7ea24267c7f48ccf0a30cdeb2308eee60bfef9d5e60bc358aa4567b488bf4de93cddbbf7125576c4a2f29333fa20c50860c", 256);
    cheat_assert(strncmp(
        "2ea190bef27875b26769f5898acfae3b1cb679f2",
        toLowerCase(BN_bn2hex(K)),
        40
    ) == 0);
)
